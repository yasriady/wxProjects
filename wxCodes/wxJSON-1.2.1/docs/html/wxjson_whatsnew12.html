<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>wxJSON: wxJSON - The wxWidgets implementation of JSON</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.5 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1><a class="anchor" name="wxjson_whatsnew12">What's new in version 1.2 </a></h1>This version is mainly a code cleanup, bug fix and compilation's errors fix.<p>
<ul>
<li><a class="el" href="wxjson_whatsnew12.html#json_ver12_cleanup">Code cleanup</a> </li>
<li><a class="el" href="wxjson_whatsnew12.html#json_ver12_stl">Compatible with STL-enabled wxWdigets' builds</a> </li>
<li><a class="el" href="wxjson_whatsnew12.html#json_ver12_doubles">Issues when writing doubles</a></li>
</ul>
<h2><a class="anchor" name="json_ver12_cleanup">
Code cleanup</a></h2>
In this version I made some cleanup of:<p>
<ul>
<li>unused code, functions and static data </li>
<li>commented-out code </li>
<li>line-ending confusion: all lines now ends with the unix-style ending character: LF </li>
<li>replaced the TAB char for indentation with 4-spaces as stated by the wxWidgets' coding guidelines</li>
</ul>
<h2><a class="anchor" name="json_ver12_stl">
Compatible with STL-enabled wxWdigets' builds</a></h2>
There was a problem in compiling wxJSON if wxWdigets is built using the<p>
<div class="fragment"><pre class="fragment">  --enable-stl
</pre></div><p>
flag. The problem is related to the declaration of the <code>wxJSONInternalMap</code> type which represents the container of key/value pairs. The declaration of such a type is:<p>
<div class="fragment"><pre class="fragment">  <span class="keyword">class </span><a class="code" href="json__defs_8h.html#83af09a7520d355ab3ae25d6900e3bc8">WXDLLIMPEXP_JSON</a> <a class="code" href="jsonval_8h.html#fd467c09a9467362fe6ede843fa5333a">wxJSONInternalMap</a>;   <span class="comment">// forward declaration</span>
  
  <span class="keyword">class </span><a class="code" href="json__defs_8h.html#83af09a7520d355ab3ae25d6900e3bc8">WXDLLIMPEXP_JSON</a> <a class="code" href="classwxJSONValue.html" title="The JSON value class implementation.">wxJSONValue</a>
  {
    ...
    <span class="comment">// this is the reason of the forward declaration</span>
    <span class="keyword">const</span> <a class="code" href="jsonval_8h.html#fd467c09a9467362fe6ede843fa5333a">wxJSONInternalMap</a>* AsMap() <span class="keyword">const</span>;
    ...
  };

  <a class="code" href="jsonval_8h.html#1fd851e43a2081acc52cd8441e089f24">WX_DECLARE_STRING_HASH_MAP</a>( <a class="code" href="classwxJSONValue.html" title="The JSON value class implementation.">wxJSONValue</a>, <a class="code" href="jsonval_8h.html#fd467c09a9467362fe6ede843fa5333a">wxJSONInternalMap</a> );
</pre></div><p>
The code declares a hasp map container of <em>strings</em> as the <em>key</em> and <em><a class="el" href="classwxJSONValue.html" title="The JSON value class implementation.">wxJSONValue</a></em> as the value. If wxWidgets is built without STL enabled the above code compiles fine.<p>
Otherwise, a compile error occurs due to the redeclaration of the <code>wxJSONInternalMap</code> type. This happen because the wxWidgets' implementation of hashmaps relies on the <b>std::hash_map</b> STL container if STL is enabled. The above code is wrong if using STL for the map container. The correct code, when using STL is the following:<p>
<div class="fragment"><pre class="fragment">  <a class="code" href="jsonval_8h.html#1fd851e43a2081acc52cd8441e089f24">WX_DECLARE_STRING_HASH_MAP</a>( <a class="code" href="classwxJSONValue.html" title="The JSON value class implementation.">wxJSONValue</a>, <a class="code" href="jsonval_8h.html#fd467c09a9467362fe6ede843fa5333a">wxJSONInternalMap</a> );
  <span class="comment">// the above is similar to:</span>
  <span class="comment">// typedef std::hash_map&lt;wxString, wxJSONValue&gt;  wxJSONInternalMap;</span>
  
  <span class="keyword">class </span><a class="code" href="json__defs_8h.html#83af09a7520d355ab3ae25d6900e3bc8">WXDLLIMPEXP_JSON</a> <a class="code" href="classwxJSONValue.html" title="The JSON value class implementation.">wxJSONValue</a>
  {
    ...
    <span class="keyword">const</span> <a class="code" href="jsonval_8h.html#fd467c09a9467362fe6ede843fa5333a">wxJSONInternalMap</a>* AsMap() <span class="keyword">const</span>;
    ...
  };
</pre></div><p>
In this version, the <b>wxJSON</b> library checks if STL is enabled in wxWidgets and conditionally compiles the library so that no compilation error occurs.<h2><a class="anchor" name="json_ver12_doubles">
Issues when writing doubles</a></h2>
There is an issue in the <a class="el" href="classwxJSONWriter.html" title="The JSON document writer.">wxJSONWriter</a> class when a JSON value of type <b>double</b> is written to the JSON text representation. The writer relies on the <b>snprintf</b> function to write a text representation of the double as a string of decimal digits.<p>
You may also know that some decimal fractional number cannot be exactly represented in binary format (and viceversa). For example, the decimal fraction <b>1/10</b> cannot be representated correctly in binary. The problem is that when writing that number to JSON text you may get one of the following:<p>
<div class="fragment"><pre class="fragment">  0.1
  0.100000
  0.10000000000000000555
</pre></div><p>
depending on the precision flags used in the format string. For this reason, the wxJSON writer uses a default format string of:<p>
<div class="fragment"><pre class="fragment">  %.10g
</pre></div><p>
which specifies a precision of ten significant decimal digits suppressing trailing ZEROes. You can modify the format string using the <code><a class="el" href="classwxJSONWriter.html#5f77d5f0cfa2c781b3e5cbb11a636697" title="Set the format string for double values.">wxJSONWriter::SetDoubleFmtString</a></code> member function. The format string set by this function is used for all JSON text generated by the wxJSON writer object for which the function was called. </div>
<hr size="1"><address style="text-align: right;"><small>Generated on Thu Jan 7 22:40:56 2010 for wxJSON by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.5 </small></address>
</body>
</html>
